[[source_code]]
== C칩digo fuente


[[threads_source]]
=== Creaci칩n de threads

[[threads_c]]
[source,c]
.threads.c
----
include::../code/threads.c[]
----

[[threads_py]]
[source,python]
.threads.py
----
include::../code/threads.py[]
----

[[gothreads_go]]
[source,go]
.gothreads.go
----
include::../code/gothreads.go[]
----

[[threads_java]]
[source,java]
.Threads.java
----
include::../code/Threads.java[]
----



[[counter_add]]
=== Incrementar un contador con dos hilos

[[counter_c]]
[source,c]
.counter.c
----
include::../code/counter.c[]
----

[[counter_py]]
[source,python]
.counter.py
----
include::../code/counter.py[]
----

[[gocounter_go]]
[source,go]
.gocounter.go
----
include::../code/gocounter.go[]
----

[[counter_java]]
[source,java]
.Counter.java
----
include::../code/Counter.java[]
----

[[counter_local_c]]
[source,c]
.counter_local.c
----
include::../code/counter_local.c[]
----


[[counter_peterson]]
=== Algoritmo de Peterson con barreras de memoria

[[counter_peterson_c]]
[source,c]
.counter_peterson.c
----
include::../code/counter_peterson.c[]
----

=== Instrucciones por hardware


[[getAndSet]]
==== getAndSet


[[counter_get_and_set_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/counter_get_and_set.c[counter_get_and_set.c]
[source,c]
----
include::../code/hardware/counter_get_and_set.c[]
----



[[getAndAdd]]
==== getAndAdd

[[counter_get_and_add_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/counter_get_and_add.c[counter_get_and_add.c]
[source,c]
----
include::../code/hardware/counter_get_and_add.c[]
----


[[gocounter_get_and_add_go]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/gocounter_get_and_add.go[gocounter_get_and_add.go]
[source,go]
----
include::../code/hardware/gocounter_get_and_add.go[]
----

[[testAndSet]]
==== testAndSet

[[counter_test_and_set_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/counter_test_and_set.c[counter_test_and_set.c]
[source,c]
----
include::../code/hardware/counter_test_and_set.c[]
----


[[swap]]
==== Swap

[[counter_swap_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/counter_swap.c[counter_swap.c]
[source,c]
----
include::../code/hardware/counter_swap.c[]
----


[[gocounter_swap_go]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/gocounter_swap.go[gocounter_swap.go]
[source,go]
----
include::../code/hardware/gocounter_swap.go[]
----


[[compareAndSwap]]
==== compareAndSwap

[[counter_compare_and_swap_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/counter_compare_and_swap.c[counter_compare_and_swap.c]
[source,c]
----
include::../code/hardware/counter_compare_and_swap.c[]
----

[[gocounter_compare_and_swap_go]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/gocounter_compare_and_swap.go[gocounter_compare_and_swap.go]
[source,go]
----
include::../code/hardware/gocounter_compare_and_swap.go[]
----

==== ABA

[[stack_cas_malloc_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/stack_cas_malloc.c[stack_cas_malloc.c]
[source,c]
----
include::../code/hardware/stack_cas_malloc.c[]
----

[[stack_cas_freelist_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/stack_cas_freelist.c[stack_cas_freelist.c]
[source,c]
----
include::../code/hardware/stack_cas_freelist.c[]
----

[[stack_cas_tagged_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/stack_cas_tagged.c[stack_cas_tagged.c]
[source,c]
----
include::../code/hardware/stack_cas_tagged.c[]
----


[[LL_SC]]
==== LL/SC

[[stack_llsc_freelist_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/arm/stack_llsc_freelist.c[stack_llsc_freelist.c]
[source,c]
----
include::../code/hardware/arm/stack_llsc_freelist.c[]
----

[[stack_llsc_freelist_s]]
https://github.com/gallir/concurrencia_source_samples/blob/master/hardware/arm/stack_llsc_freelist.s[stack_llsc_freelist.s]
[source,c]
----
include::../code/hardware/arm/stack_llsc.s[]
----

=== Optimizaciones de _spinlocks_

==== Test&TAS
[[test_test_and_set_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/test_test_and_set.c[test_test_and_set.c]
[source,c]
----
include::../code/spinlocks/test_test_and_set.c[]
----

==== Test&swap
[[test_swap_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/test_swap.c[test_swap.c]
[source,c]
----
include::../code/spinlocks/test_swap.c[]
----

==== Test&CAS
[[test_compare_and_swap_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/test_compare_and_swap.c[test_compare_and_swap.c]
[source,c]
----
include::../code/spinlocks/test_compare_and_swap.c[]
----

==== TAS + yield
[[test_and_set_yield_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/test_and_set_yield.c[test_and_set_yield.c]
[source,c]
----
include::../code/spinlocks/test_and_set_yield.c[]
----

==== Swap + yield
[[swap_yield_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/swap_yield.c[swap_yield.c]
[source,c]
----
include::../code/spinlocks/swap_yield.c[]
----

==== CAS + yield
[[compare_and_swap_yield_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/compare_and_swap_yield.c[compare_and_swap_yield.c]
[source,c]
----
include::../code/spinlocks/compare_and_swap_yield.c[]
----


==== TAS + backoff
[[test_and_set_backoff_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/test_and_set_backoff.c[test_and_set_backoff.c]
[source,c]
----
include::../code/spinlocks/test_and_set_backoff.c[]
----

==== Swap + backoff
[[swap_backoff_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/swap_backoff.c[swap_backoff.c]
[source,c]
----
include::../code/spinlocks/swap_backoff.c[]
----

==== CAS + backoff
[[compare_and_swap_backoff_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/compare_and_swap_backoff.c[compare_and_swap_backoff.c]
[source,c]
----
include::../code/spinlocks/compare_and_swap_backoff.c[]
----


=== Lectores-escritores

[[rw_lock_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/rw_lock.c[rw_lock.c]
[source,c]
----
include::../code/spinlocks/rw_lock.c[]
----

=== Algoritmos equitativos

==== _Ticket-lock_
[[ticket_lock_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/ticket_lock.c[ticket_lock.c]
[source,c]
----
include::../code/spinlocks/ticket_lock.c[]
----

==== Lectores-escritores

[[ticket_rw_lock_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/ticket_rw_lock.c[ticket_rw_lock.c]
[source,c]
----
include::../code/spinlocks/ticket_rw_lock.c[]
----

==== _Spinlocks_ escalables

===== _Array-lock_
[[array_lock_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/array_lock.c[array_lock.c]
[source,c]
----
include::../code/spinlocks/array_lock.c[]
----

===== MCS Spinlock
[[mcs_spinlock_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/mcs_spinlock.c[mcs_spinlock.c]
[source,c]
----
include::../code/spinlocks/mcs_spinlock.c[]
----

===== CLH Spinlock
[[clh_spinlock_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/spinlocks/clh_spinlock.c[clh_spinlock.c]
[source,c]
----
include::../code/spinlocks/clh_spinlock.c[]
----


=== Sem치foros


==== Exclusi칩n mutua

[[sem_counter_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/semaphores/semaphore.c[semaphore.c]
[source,c]
----
include::../code/semaphores/semaphore.c[]
----

[[sem_counter_py]]
https://github.com/gallir/concurrencia_source_samples/blob/master/semaphores/semaphore.py[semaphore.py]
[source,python]
----
include::../code/semaphores/semaphore.py[]
----

[[sem_counter_java]]
https://github.com/gallir/concurrencia_source_samples/blob/master/semaphores/CounterSemaphore.java[CounterSemaphore.java]
[source,java]
----
include::../code/semaphores/CounterSemaphore.java[]
----

[[sem_mutex_c]]
https://github.com/gallir/concurrencia_source_samples/blob/master/semaphores/mutex.c[mutex.c]
[source,c]
----
include::../code/semaphores/mutex.c[]
----

[[go_mutex_go]]
https://github.com/gallir/concurrencia_source_samples/blob/master/semaphores/go_mutex.go[go_mutex.go]
[source,go]
----
include::../code/semaphores/go_mutex.go[]
----

[[sem_lock_java]]
https://github.com/gallir/concurrencia_source_samples/blob/master/semaphores/CounterLock.java[CounterLock.java]
[source,java]
----
include::../code/semaphores/CounterLock.java[]
----

[[sem_lock_py]]
https://github.com/gallir/concurrencia_source_samples/blob/master/semaphores/lock.py[lock.py]
[source,python]
----
include::../code/semaphores/lock.py[]
----

[[sem_lock_with_py]]
https://github.com/gallir/concurrencia_source_samples/blob/master/semaphores/lock_with.py[lock_with.py]
[source,python]
----
include::../code/semaphores/lock_with.py[]
----

[[producer_consumer_infinite_py]]
https://github.com/gallir/concurrencia_source_samples/blob/master/semaphores/producer-consumer-infinite.py[producer-consumer-infinite.py]
[source,python]
----
include::../code/semaphores/producer-consumer-infinite.py[]
----

[[producer_consumer_py]]
https://github.com/gallir/concurrencia_source_samples/blob/master/semaphores/producer-consumer.py[producer-consumer.py]
[source,python]
----
include::../code/semaphores/producer-consumer-infinite.py[]
----
